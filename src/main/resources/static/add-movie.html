<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Add New Movie</title>
    <style>
        body { font-family: sans-serif; margin: 2em; max-width: 600px; }
        form { display: flex; flex-direction: column; gap: 1em; }
        .form-group { display: flex; flex-direction: column; }
        label { margin-bottom: 0.5em; font-weight: bold; }
        input, textarea { padding: 0.5em; border: 1px solid #ccc; border-radius: 4px; }
        button { background-color: #007bff; color: white; border: none; padding: 0.75em; border-radius: 4px; cursor: pointer; font-size: 1em; }
    </style>
</head>
<body>
<p><a href="/">&laquo; 목록으로 돌아가기</a></p>
<hr>

<h1>📝 새 영화 정보 추가하기</h1>

<form id="add-movie-form">
    <div class="form-group">
        <label for="id">영화 ID</label>
        <input type="number" id="id" required>
    </div>
    <div class="form-group">
        <label for="title">제목</label>
        <input type="text" id="title" required>
    </div>
    <div class="form-group">
        <label for="releaseYear">출시년도</label>
        <input type="number" id="releaseYear" required>
    </div>
    <div class="form-group">
        <label for="posterPath">포스터 경로</label>
        <input type="text" id="posterPath" placeholder="/abcdef.jpg">
    </div>
    <div class="form-group">
        <label for="overview">줄거리</label>
        <textarea id="overview" rows="5"></textarea>
    </div>
    <button type="submit">저장하기</button>
</form>

<script>
    const form = document.getElementById('add-movie-form');

    form.addEventListener('submit', (event) => {
        // 1. form의 기본 제출 동작(새로고침)을 막습니다.
        event.preventDefault();

        // 2. 각 input 태그에서 사용자가 입력한 값을 가져옵니다.
        const movieData = {
            id: document.getElementById('id').value,
            title: document.getElementById('title').value,
            releaseYear: document.getElementById('releaseYear').value,
            posterPath: document.getElementById('posterPath').value,
            overview: document.getElementById('overview').value
        };

        // 3. fetch를 이용해 서버에 POST 요청을 보냅니다.
        fetch('/api/movies', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json', // 보내는 데이터가 JSON 형식임을 알려줍니다.
            },
            body: JSON.stringify(movieData), // JavaScript 객체를 JSON 문자열로 변환합니다.
        })
            .then(response => {
                if (response.ok) {
                    alert('새 영화가 성공적으로 추가되었습니다.');
                    window.location.href = '/'; // 저장 후 목록 페이지로 이동
                } else {
                    alert('영화 추가에 실패했습니다.');
                }
            })
            .catch(error => console.error('영화 추가 중 오류 발생:', error));
    });
</script>
</body>
</html>