<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Movie Detail</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">ğŸ¬ My Movie App</a>
        <div class="d-flex" id="auth-links"></div>
    </div>
</nav>

<div class="container mt-4">
    <p><a href="/">&laquo; ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a></p>
    <hr>
    <div id="movie-detail"></div>
    <hr>
    <div id="review-section" class="mt-4">
        <h2>ë¦¬ë·°</h2>
        <form id="review-form" class="mb-4">
            <div class="mb-3">
                <label for="review-content" class="form-label">ë¦¬ë·° ì‘ì„±í•˜ê¸°:</label>
                <textarea id="review-content" class="form-control" rows="3" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">ë¦¬ë·° ì œì¶œ</button>
        </form>
        <ul id="review-list" class="list-group"></ul>
    </div>
</div>

<script>
    // ... (JavaScript ë¡œì§ì€ ì´ì „ê³¼ ë™ì¼) ...
    // ë‹¨, ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ì„ ìœ„í•œ ì½”ë“œê°€ ì¶”ê°€ë©ë‹ˆë‹¤.
    document.addEventListener('DOMContentLoaded', () => {
        const authLinks = document.getElementById('auth-links');
        const token = localStorage.getItem('jwt');
        if (!token) {
            authLinks.innerHTML = '<a href="/login.html" class="btn btn-success">ë¡œê·¸ì¸</a>';
            // í† í° ì—†ìœ¼ë©´ ìƒì„¸í˜ì´ì§€ ì ‘ê·¼ ë¶ˆê°€
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            window.location.href = '/login.html';
            return;
        } else {
            authLinks.innerHTML = '<button id="logout-button" class="btn btn-light">ë¡œê·¸ì•„ì›ƒ</button>';
            document.getElementById('logout-button').addEventListener('click', () => {
                localStorage.removeItem('jwt');
                alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.location.href = '/login.html';
            });
        }

        // ... (ë‚˜ë¨¸ì§€ ìƒì„¸í˜ì´ì§€ ë¡œì§ì€ ì´ì „ ë‹µë³€ê³¼ ê±°ì˜ ë™ì¼í•˜ë©°, Bootstrap í´ë˜ìŠ¤ì— ë§ê²Œ ì¼ë¶€ ìˆ˜ì •ë¨) ...
        const urlParams = new URLSearchParams(window.location.search);
        const movieId = urlParams.get('id');
        const movieDetail = document.getElementById('movie-detail');
        const reviewList = document.getElementById('review-list');
        const reviewForm = document.getElementById('review-form');

        const fetchOptions = { headers: { 'Authorization': token }};

        // ì˜í™” ìƒì„¸ ì •ë³´
        fetch(`/api/movies/${movieId}`, fetchOptions)
            .then(res => res.json())
            .then(movie => {
                const imageUrl = movie.posterPath ? `https://image.tmdb.org/t/p/w500${movie.posterPath}` : 'https://via.placeholder.com/500x750.png?text=No+Image';
                movieDetail.innerHTML = `
                        <div class="row">
                            <div class="col-md-4">
                                <img src="${imageUrl}" class="img-fluid rounded" alt="${movie.title} poster">
                            </div>
                            <div class="col-md-8">
                                <h1>${movie.title} <span class="text-muted">(${movie.releaseYear})</span></h1>
                                <p class="lead">${movie.overview}</p>
                                <a href="edit-movie.html?id=${movie.id}" class="btn btn-success">ì •ë³´ ìˆ˜ì •</a>
                                <button id="delete-button" class="btn btn-danger">ì‚­ì œ</button>
                            </div>
                        </div>
                    `;
                document.getElementById('delete-button').addEventListener('click', () => {
                    if (confirm('ì •ë§ë¡œ ì´ ì˜í™”ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        fetch(`/api/movies/${movieId}`, { method: 'DELETE', headers: { 'Authorization': token }})
                            .then(res => {
                                if(res.ok) {
                                    alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                                    window.location.href = '/';
                                } else {
                                    alert('ì‚­ì œ ì‹¤íŒ¨');
                                }
                            });
                    }
                });
            });

        // ë¦¬ë·° ëª©ë¡
        fetch(`/api/movies/${movieId}/reviews`, fetchOptions)
            .then(res => res.json())
            .then(reviews => {
                reviewList.innerHTML = '';
                if (reviews.length > 0) {
                    reviews.forEach(review => {
                        reviewList.innerHTML += `
                                <li class="list-group-item">
                                    <strong>${review.username}</strong>
                                    <p class="mb-0">${review.content}</p>
                                </li>
                            `;
                    });
                } else {
                    reviewList.innerHTML = '<li class="list-group-item">ì‘ì„±ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
                }
            });

        // ë¦¬ë·° ì‘ì„±
        reviewForm.addEventListener('submit', e => {
            e.preventDefault();
            const content = document.getElementById('review-content').value;
            fetch(`/api/movies/${movieId}/reviews`, {
                method: 'POST',
                headers: { 'Authorization': token, 'Content-Type': 'application/json' },
                body: JSON.stringify({ content })
            })
                .then(res => res.json())
                .then(newReview => {
                    //... (ì´ì „ê³¼ ë™ì¼í•œ ë¡œì§)
                    window.location.reload(); // ê°„ë‹¨í•˜ê²Œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ì²˜ë¦¬
                });
        });
    });
</script>
</body>
</html>