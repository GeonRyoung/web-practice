<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>My Movie List</title>
    <style>
        /* ... ìŠ¤íƒ€ì¼ì€ ì´ì „ê³¼ ë™ì¼ ... */
        body { font-family: sans-serif; margin: 2em; }
        #search-container { margin-bottom: 2em; } /* ê²€ìƒ‰ì°½ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        #movie-list { list-style: none; padding: 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1em; }
        li { border: 1px solid #ccc; border-radius: 8px; padding: 1em; text-align: center; }
        img { max-width: 100%; height: auto; border-radius: 4px; }
        h3 { margin: 0.5em 0; }
    </style>
</head>
<body>

<h1>ğŸ¬ ì˜í™” ëª©ë¡</h1>

<a href="/add-movie.html" style="margin-bottom: 1em; display: inline-block;">+ ìƒˆ ì˜í™” ì¶”ê°€í•˜ê¸°</a>

<div id="search-container">
    <input type="text" id="search-input" placeholder="ì˜í™” ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”...">
    <button id="search-button">ê²€ìƒ‰</button>
</div>

<ul id="movie-list"></ul>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const movieList = document.getElementById('movie-list');
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');

        // ===== 2. ì˜í™” ëª©ë¡ì„ í™”ë©´ì— ê·¸ë¦¬ëŠ” ë¶€ë¶„ì„ í•¨ìˆ˜ë¡œ ë¶„ë¦¬ =====
        const displayMovies = (movies) => {
            movieList.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ì„ ê¹¨ë—í•˜ê²Œ ë¹„ì›ë‹ˆë‹¤.

            movies.forEach(movie => {
                const listItem = document.createElement('li');
                const imageUrl = `https://image.tmdb.org/t/p/w200${movie.posterPath}`;

                // ===== ë³€ê²½ëœ ë¶€ë¶„ ì‹œì‘ =====
                // a íƒœê·¸ë¡œ ì „ì²´ ë‚´ìš©ì„ ê°ì‹¸ì„œ ë§í¬ë¥¼ ë§Œë“­ë‹ˆë‹¤.
                // href ì†ì„±ì— detail.html?id=ì˜í™”ID í˜•ì‹ìœ¼ë¡œ ì£¼ì†Œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
                listItem.innerHTML = `
            <a href="detail.html?id=${movie.id}">
                <img src="${imageUrl}" alt="${movie.title} poster">
                <h3>${movie.title}</h3>
                <p>(${movie.releaseYear})</p>
            </a>
        `;
                // ===== ë³€ê²½ëœ ë¶€ë¶„ ë =====

                // a íƒœê·¸ì— ìŠ¤íƒ€ì¼ì„ ì¶”ê°€í•˜ì—¬ ë°‘ì¤„ì„ ì—†ì•±ë‹ˆë‹¤.
                listItem.querySelector('a').style.textDecoration = 'none';
                listItem.querySelector('a').style.color = 'inherit';

                movieList.appendChild(listItem);
            });
        };

        // ===== 3. ì´ˆê¸° í˜ì´ì§€ ë¡œë“œ ì‹œ ì „ì²´ ì˜í™” ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ =====
        const fetchAllMovies = () => {
            fetch('/api/movies')
                .then(response => response.json())
                .then(movies => displayMovies(movies)) // í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì„œ í™”ë©´ì— í‘œì‹œ
                .catch(error => console.error('ì˜í™” ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error));
        };

        // ===== 4. ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬ =====
        searchButton.addEventListener('click', () => {
            const searchTerm = searchInput.value; // ê²€ìƒ‰ì°½ì— ì…ë ¥ëœ ê°’ ê°€ì ¸ì˜¤ê¸°
            if (searchTerm) {
                // ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ ê²€ìƒ‰ APIë¥¼ í˜¸ì¶œ
                fetch(`/api/movies/search?title=${searchTerm}`)
                    .then(response => response.json())
                    .then(movies => displayMovies(movies)) // ê²€ìƒ‰ ê²°ê³¼ë¥¼ í™”ë©´ì— í‘œì‹œ
                    .catch(error => console.error('ì˜í™” ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error));
            } else {
                // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ì „ì²´ ëª©ë¡ì„ ë‹¤ì‹œ ë³´ì—¬ì¤Œ
                fetchAllMovies();
            }
        });

        // í˜ì´ì§€ê°€ ì²˜ìŒ ì—´ë¦´ ë•Œ ì „ì²´ ì˜í™” ëª©ë¡ì„ í•œë²ˆ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
        fetchAllMovies();
    });
</script>

</body>
</html>