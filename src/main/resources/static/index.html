<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>My Movie List</title>
    <style>
        /* ... 스타일은 이전과 동일 ... */
        body { font-family: sans-serif; margin: 2em; }
        #search-container { margin-bottom: 2em; } /* 검색창 스타일 추가 */
        #movie-list { list-style: none; padding: 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1em; }
        li { border: 1px solid #ccc; border-radius: 8px; padding: 1em; text-align: center; }
        img { max-width: 100%; height: auto; border-radius: 4px; }
        h3 { margin: 0.5em 0; }
    </style>
</head>
<body>

<h1>🎬 영화 목록</h1>

<a href="/add-movie.html" style="margin-bottom: 1em; display: inline-block;">+ 새 영화 추가하기</a>

<div id="search-container">
    <input type="text" id="search-input" placeholder="영화 제목을 입력하세요...">
    <button id="search-button">검색</button>
</div>

<ul id="movie-list"></ul>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const movieList = document.getElementById('movie-list');
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');

        // ===== 2. 영화 목록을 화면에 그리는 부분을 함수로 분리 =====
        const displayMovies = (movies) => {
            movieList.innerHTML = ''; // 기존 목록을 깨끗하게 비웁니다.

            movies.forEach(movie => {
                const listItem = document.createElement('li');
                const imageUrl = `https://image.tmdb.org/t/p/w200${movie.posterPath}`;

                // ===== 변경된 부분 시작 =====
                // a 태그로 전체 내용을 감싸서 링크를 만듭니다.
                // href 속성에 detail.html?id=영화ID 형식으로 주소를 지정합니다.
                listItem.innerHTML = `
            <a href="detail.html?id=${movie.id}">
                <img src="${imageUrl}" alt="${movie.title} poster">
                <h3>${movie.title}</h3>
                <p>(${movie.releaseYear})</p>
            </a>
        `;
                // ===== 변경된 부분 끝 =====

                // a 태그에 스타일을 추가하여 밑줄을 없앱니다.
                listItem.querySelector('a').style.textDecoration = 'none';
                listItem.querySelector('a').style.color = 'inherit';

                movieList.appendChild(listItem);
            });
        };

        // ===== 3. 초기 페이지 로드 시 전체 영화 목록을 가져오는 함수 =====
        const fetchAllMovies = () => {
            fetch('/api/movies')
                .then(response => response.json())
                .then(movies => displayMovies(movies)) // 함수를 호출해서 화면에 표시
                .catch(error => console.error('영화 목록을 가져오는 중 오류 발생:', error));
        };

        // ===== 4. 검색 버튼 클릭 이벤트 처리 =====
        searchButton.addEventListener('click', () => {
            const searchTerm = searchInput.value; // 검색창에 입력된 값 가져오기
            if (searchTerm) {
                // 검색어가 있으면 검색 API를 호출
                fetch(`/api/movies/search?title=${searchTerm}`)
                    .then(response => response.json())
                    .then(movies => displayMovies(movies)) // 검색 결과를 화면에 표시
                    .catch(error => console.error('영화 검색 중 오류 발생:', error));
            } else {
                // 검색어가 없으면 전체 목록을 다시 보여줌
                fetchAllMovies();
            }
        });

        // 페이지가 처음 열릴 때 전체 영화 목록을 한번 불러옵니다.
        fetchAllMovies();
    });
</script>

</body>
</html>